<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>
    Covid19MM Admin Dashboard
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../assets/css/pop.css" rel="stylesheet" />
  <link href="../assets/css/paper-dashboard.css?v=2.0.1" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="../assets/demo/demo.css" rel="stylesheet" />
  <style>
    /* The Modal (background) */
    .modal {
      display: none;
      /* Hidden by default */
      position: fixed;
      /* Stay in place */
      z-index: 1;
      /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      overflow: auto;
      /* Enable scroll if needed */
      background-color: rgb(0, 0, 0);
      /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4);
      /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      /* 15% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>

<body class="" onload="Starting()">
  <div class="wrapper ">
    <div class="sidebar" data-color="white" data-active-color="danger">
      <div class="logo">
        <a href="" class="simple-text logo-mini">
          <div class="logo-image-small">
            <img src="../assets/img/default-avatar.png">
          </div>
        </a>
        <a href="" class="simple-text logo-normal" style="font-size: 25px; color: black; font-weight: 500;" id="adminName">
          Admin
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li>
            <a href="#">
              <!--<i class="nc-icon nc-single-02"></i>-->
              <div>
                <p style="color: blue; font-weight: 530; font-size: 14px;">
                  Add More
                  <!--&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&ensp;&nbsp;-->
                  <form action="/api/generate/" enctype="multipart/form-data" method="post">
                    <input type="file" name="file-to-upload">
                    <input type="submit" value="Upload">
                  </form>
                  <!--<span class="fa fa-plus-circle fa-fw" style="font-size:22px;"></span>-->
                </p>
              </div>
            </a>
          </li>
          <hr>


          <li class="active-pro">
            <hr>
            <form method="POST" action="http://localhost:3000/api/admin/logout">
              <button type="submit" style="background: none;">
                <p style="color: red; font-weight: 530; font-size: 14px;">
                  Logout &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;
                  <span class="fa fa-times-circle" style="font-size:22px;"></span>
                </p>
              </button>
            </form>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid" style="background-color: blue;">
          <div class="navbar-wrapper">
            <div class="navbar-toggle">
              <button type="button" class="navbar-toggler">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </button>
            </div>
            <a class="navbar-brand" style="color: white;">Dashboard</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
            aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title"> Contacts Phone Number</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive" style="height: 55vh;">
                  <table class="table" style="table-layout: auto; width: 100%;height:100px">
                    <thead class=" text-primary" style="background-color: blue; text-align: center;" id="TableHead">
                    </thead>
                    <tbody id="TableBody">

                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--- end table-->
      <!-- The Modal -->
      <div id="popAddDiv" class="modal">
        <!--<span onclick="document.getElementById('pop').style.display='none'" class="close"
          title="Close Modal">&times;</span>-->

        <!-- Modal Content -->
        <form class="modal-content animate" id="popupAddForm" action="" method="POST">
          <div class="imgcontainer" id="popupAddHead">
          </div>

          <div class="container" id="popupAddBody">
          </div>
        </form>
      </div>

      <div id="popUpdateDiv" class="modal">
        <!--<span onclick="document.getElementById('pop').style.display='none'" class="close"
          title="Close Modal">&times;</span>-->

        <!-- Modal Content -->
        <form class="modal-content animate" id="popupUpdateForm" action="" method="POST">
          <div class="imgcontainer" id="popupUpdateHead">
          </div>

          <div class="container" id="popupUpdateBody">
          </div>
        </form>
      </div>

      <div id="popDeleteDiv" class="modal">
        <!--<span onclick="document.getElementById('pop').style.display='none'" class="close"
          title="Close Modal">&times;</span>-->

        <!-- Modal Content -->
        <form class="modal-content animate" id="popupDeleteForm" action="" method="POST">
          <div class="imgcontainer" id="popupDeleteHead">
          </div>

          <div class="container" id="popupDeleteBody">
          </div>
        </form>
      </div>

      <div style="margin-left: 50px; color: blue;">
        <p><a style="color: blue;float: left;" onclick="PopUpTheForm(this)" id="Add">Add more data &nbsp;
            <span class="fa fa-plus-circle fa-fw" style="font-size:22px;"></span></a>
        </p>
        <p><a href="http://localhost:3000/api/generate/readfiles" style="color: blue;float: left;">Read Files &nbsp;
        </p>
        <p><a href="http://localhost:3000/api/generate/loadModule" style="color: blue;float: left;">Load Modules &nbsp;
        </p>
        <p><a href="http://localhost:3000/api/generate/loadData" style="color: blue;float: left;">Load Data &nbsp;
        </p>
        <p><a href="http://localhost:3000/api/generate/CreateRoute" style="color: blue;float: left;">Create Routes
            &nbsp;
        </p>
        <p><a href="http://localhost:3000/api/generate/loadRoute" style="color: blue;float: left;">Load Routes &nbsp;
        </p>
        <div style="float:right;margin-right: 10%;width: 10%;">
          <p>
            <a style="color: blue;float: left;" onclick="PopUpTheForm(this)" id="Delete">
              <span class="fa fa-trash" style="font-size:30px;"></span>
            </a>
            <a style="color: blue;float: right;" onclick="PopUpTheForm(this)" id="Update">
              <span class="fa fa-edit" style="font-size:30px;"></span>
            </a>
          </p>
        </div>
      </div>

    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Chart JS -->
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/paper-dashboard.min.js?v=2.0.1" type="text/javascript"></script>
  <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
  <script src="../assets/demo/demo.js"></script>
  <script>
    var selectedId;
    var TheObj;
    var allNav = [];
    var currentNav;

    function Starting() {
      try {
        var admin = document.getElementById("adminName");
        admin.innerHTML = getCookie("acc");
        var request = new XMLHttpRequest()
        request.open('GET', 'http://localhost:3000/api/admin/collections', true)
        request.onload = function () {
          var ultag = document.getElementsByClassName("nav");
          ultag = ultag[0];
          console.log(ultag);
          var data;
          // Begin accessing JSON data here
          try {
            data = JSON.parse(this.response)
          } catch (e) {
            console.log("Json parse error");
            window.location = "http://localhost:3000/static/coviddashB/html/login.html";
          }
          var apiloader = true;

          if (request.status >= 200 && request.status < 400) {
            data.forEach(ele => {
              console.log(ele)
              allNav.push(ele);
              var textnode = document.createTextNode(ele);
              var ptag = document.createElement("p");
              ptag.style = "color: blue; font-weight: 530; font-size: 14px;";
              var atag = document.createElement("a");
              var litag = document.createElement("li");
              if (apiloader) {
                litag.id = ele;
                litag.onload = TableLoader(ele);
                litag.onload = function () { TableLoader(ele) };
                litag.onclick = function () { TableLoader(ele) };
                apiloader = false;
              }
              else {
                litag.id = ele;
                litag.onclick = function () { TableLoader(ele) };
              }
              ptag.appendChild(textnode);
              atag.appendChild(ptag);
              litag.appendChild(atag);
              ultag.appendChild(litag);
            })
          } else {
            console.log('error')
          }
        }

        request.send()
      } catch (e) {
        console.log("error");
        console.log(e);
      }
    }

    function TableLoader(ele) {
      currentNav = ele;
      Ttitle = document.getElementsByClassName("card-title");
      Ttitle = Ttitle[0];
      Ttitle.innerHTML = ele;
      Thead = document.getElementById("TableHead");
      Tbody = document.getElementById("TableBody");
      Thead.innerHTML = "";
      Tbody.innerHTML = "";
      console.log("Table");
      console.log(ele);
      var request = new XMLHttpRequest()
      request.open('GET', 'http://localhost:3000/api/generate/api/' + ele, true)
      request.onload = function () {
        var data;
        data = JSON.parse(this.response)
        if (request.status >= 200 && request.status < 400) {
          var obj = data[0];
          TheObj = obj;
          console.log("The Object")
          console.log(TheObj);

          for (var p in obj) {
            if (obj.hasOwnProperty(p)) {

              console.log(p);
              console.log(obj[p]);
              if (p != "_id" && p != "__v") {
                console.log("Appending");
                var Th = document.createElement("th");
                Th.style = "color:white;";
                Th.innerHTML = p;
                Thead.appendChild(Th);
              }
              else if (p == "_id") {
                var Th = document.createElement("th");
                Th.style = "color:white;";
                Thead.appendChild(Th);
              }
            }
          }

          var makeChecked = true;

          data.forEach(element => {
            var obj = element;
            var Tr = document.createElement("tr");
            Tr.style = "text-align: center;";
            for (var p in obj) {
              if (obj.hasOwnProperty(p)) {
                if (p != "_id" && p != "__v") {
                  var Td = document.createElement("td");
                  Td.innerHTML = obj[p];
                  Tr.appendChild(Td);
                }
                else if (p == "_id") {
                  var Td = document.createElement("td");
                  var In = document.createElement("input");
                  In.type = "radio";
                  In.name = p;
                  In.value = obj[p];
                  In.onclick = function () { clicker(this) };
                  if (makeChecked) {
                    makeChecked = false;
                    In.checked = true;
                    selectedId = obj[p];
                  }
                  Td.appendChild(In);
                  Tr.id = obj[p];
                  Tr.appendChild(Td);
                }
              }
            }
            Tbody.appendChild(Tr);
          });
          PopUpCreation();
        } else {
          console.log('error')
        }
      }

      request.send()
    }

    function PopUpCreation() {
      try {
        console.log("Add");
        var formheadAdd = document.getElementById("popupAddHead");
        var formheadUpdate = document.getElementById("popupUpdateHead");
        var formheadDelete = document.getElementById("popupDeleteHead");
        console.log(formheadAdd);

        console.table([formheadAdd, formheadUpdate, formheadDelete]);
        var formPopAdd = document.getElementById("popupAddForm");
        var formPopUpdate = document.getElementById("popupUpdateForm");
        var formPopDelete = document.getElementById("popupDeleteForm");
        formPopAdd.action = "/api/generate/api/" + currentNav;
        formPopUpdate.action = "/api/generate/api/" + currentNav + "/" + selectedId;
        formPopDelete.action = "/api/generate/api/" + currentNav + "/" + selectedId;

        var HAdd = document.createElement("h1");
        var HUpdate = document.createElement("h1");
        var HDelete = document.createElement("h1");
        HAdd.innerHTML = "Add";
        formheadAdd.appendChild(HAdd);
        HUpdate.innerHTML = "Update";
        formheadUpdate.appendChild(HUpdate);
        HDelete.innerHTML = "Delete";
        formheadDelete.appendChild(HDelete);

        var formbodyAdd = document.getElementById("popupAddBody");
        var formbodyUpdate = document.getElementById("popupUpdateBody");
        var formbodyDelete = document.getElementById("popupDeleteBody");
        console.log(TheObj);
        for (var p in TheObj) {
          if (TheObj.hasOwnProperty(p)) {
            if (p != "_id" && p != "__v") {
              console.log(p);

              var labeltagAdd = document.createElement("label");
              var btagAdd = document.createElement("b");
              var labeltagUpdate = document.createElement("label");
              var btagUpdate = document.createElement("b");

              btagAdd.innerHTML = p;
              labeltagAdd.appendChild(btagAdd);
              btagUpdate.innerHTML = p;
              labeltagUpdate.appendChild(btagUpdate);

              formbodyAdd.appendChild(labeltagAdd);
              formbodyUpdate.appendChild(labeltagUpdate);

              var inputtagAdd = document.createElement("input");
              inputtagAdd.type = "text";
              inputtagAdd.placeholder = "Enter " + p;
              inputtagAdd.name = p;
              inputtagAdd.required = true;
              formbodyAdd.appendChild(inputtagAdd);
              var inputtagUpdate = document.createElement("input");
              inputtagUpdate.type = "text";
              inputtagUpdate.placeholder = "Enter " + p;
              inputtagUpdate.name = p;
              inputtagUpdate.required = true;
              formbodyUpdate.appendChild(inputtagUpdate);
            }
          }
        }
        var ActionBtn = document.createElement("button");
        ActionBtn.type = "submit";
        ActionBtn.innerHTML = "Add";
        formbodyAdd.appendChild(ActionBtn);
        var ActionBtn = document.createElement("button");
        ActionBtn.type = "submit";
        ActionBtn.innerHTML = "Update";
        formbodyUpdate.appendChild(ActionBtn);
        var ActionBtn = document.createElement("button");
        ActionBtn.type = "submit";
        ActionBtn.innerHTML = "Delete";
        formbodyDelete.appendChild(ActionBtn);

        var CancelBtnAdd = document.createElement("button");
        CancelBtnAdd.className = "cancelbtn";
        CancelBtnAdd.innerHTML = "Cancel";
        CancelBtnAdd.type = "button";
        CancelBtnAdd.onclick = function () {
          document.getElementById('popAddDiv').style.display = 'none';
        }
        formbodyAdd.appendChild(CancelBtnAdd);

        var CancelBtnUpdate = document.createElement("button");
        CancelBtnUpdate.className = "cancelbtn";
        CancelBtnUpdate.innerHTML = "Cancel";
        CancelBtnUpdate.type = "button";
        CancelBtnUpdate.onclick = function () {
          document.getElementById('popUpdateDiv').style.display = 'none';
        }
        formbodyUpdate.appendChild(CancelBtnUpdate)

        var CancelBtnDelete = document.createElement("button");
        CancelBtnDelete.className = "cancelbtn";
        CancelBtnDelete.innerHTML = "Cancel";
        CancelBtnDelete.type = "button";
        CancelBtnDelete.onclick = function () {
          document.getElementById('popDeleteDiv').style.display = 'none';
        }
        formbodyDelete.appendChild(CancelBtnDelete);

      } catch (e) {
        console.log(e);

      }

    }

    function PopUpTheForm(params) {
      if (params.id == "Add") {
        document.getElementById('popAddDiv').style.display = 'block';
      }
      if (params.id == "Update") {
        var Tr = document.getElementById(selectedId);
        var formbodyUpdate = document.getElementById("popupUpdateBody");
        var formNodes = formbodyUpdate.childNodes;
        var count = 2;
        console.log(Tr);
        console.log(formNodes[count].placeholder);
        console.log(formNodes[count + 2]);
        var nodes = Tr.childNodes;
        var flag = false;
        nodes.forEach(element => {
          console.log(element.childElementCount);
          if (element.childElementCount == 0) {
            console.log("work");
            formNodes[count].value = element.innerHTML;
            count += 2;
          }
        });
        document.getElementById('popUpdateDiv').style.display = 'block';
      }
      if (params.id == "Delete") {
        document.getElementById('popDeleteDiv').style.display = 'block';
      }
    }

    function clicker(params) {
      console.log(params);
      selectedId = params.value;
    }

    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }
  </script>
</body>

</html>